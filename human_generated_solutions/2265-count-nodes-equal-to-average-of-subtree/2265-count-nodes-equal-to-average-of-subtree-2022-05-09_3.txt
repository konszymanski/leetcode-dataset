def subtree(f):
    @cache
    def g(root):
        return f(root) + g(root.left) + g(root.right) if root else 0
    return g

class Solution:
    def averageOfSubtree(self, root: Optional[TreeNode]) -> int:

        @subtree
        def sum(root):
            return root.val

        @subtree
        def number(root):
            return 1

        @subtree
        def equals_average(root):
            return root.val == sum(root) // number(root)
        
        return equals_average(root)