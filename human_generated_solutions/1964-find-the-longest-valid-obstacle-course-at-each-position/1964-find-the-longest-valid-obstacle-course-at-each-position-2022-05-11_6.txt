class Solution:
    def longestObstacleCourseAtEachPosition(self, obstacles: List[int]) -> List[int]:
        a = [10 ** 10] * (len(obstacles) + 1)
        a[0] = obstacles[0]
        lens = [1]
        
        def search_lower(val, lo, hi):
            j = 0
            
            while lo <= hi:
                mid = (lo + hi) // 2
                if a[mid] <= val:
                    j = max(mid + 1, j)
                    lo = mid + 1
                else:
                    hi = mid - 1
            return j
        
        for i in range(1, len(obstacles)):
            v = obstacles[i]
            j = search_lower(v, 0, len(a) - 1)
            a[j] = obstacles[i]
            lens.append(j + 1)
        
        return lens