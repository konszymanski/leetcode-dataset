class Solution:
    def canBeValid(self, s: str, locked: str) -> bool:
        if len(s)%2==1:return False
        unlocked=0
        left=0
        right=0
        #left to right
        for i,c in enumerate(s):
            if locked[i]=="0":unlocked+=1
            else:
                if c=="(":left+=1
                else:
                    if left:left-=1 #match with locked left first
                    elif unlocked: unlocked-=1 #then with unlocked
                    else: #unmatched )from the front
                        return False
        unlocked=0
        #right to left:
        for i in range(len(s)-1,-1,-1):
            if locked[i]=="0":unlocked+=1
            else:
                if s[i]==")":right+=1
                else:
                    if right:right-=1 #match with locked right first
                    elif unlocked: unlocked-=1 #then with unlocked
                    else: #unmatched ( from the end
                        return False
        return True