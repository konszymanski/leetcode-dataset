def isnum(s):     # check if s is composed of numbers
            try:
                int(s)
                return True
            except:
                return False

        def find(start, need_num = True): # find the next expression and evaluate it
            # need_num is to indicate whether numeric answer is preferred
            
            if expression[start] == '(':
                return helper(start+1)
            else:
                i = start
                while expression[i] not in ' )':
                    i += 1
                    
                ans = expression[start:i]

                return (int(ans) if isnum(ans) \\
                                 else values[ans] if need_num \\
                                                  else ans, \\
                        i-1)
                    
        def helper(start):        # return the answer and the index of the ending ')'
            i = start
            while expression[i] != ' ':
                i += 1
            
            op = expression[start:i]
            if op == 'let':
                return let(i+1)
            else:                 # op is either 'add' or 'mult'
                return compute(i+1, op)
        
        def compute(start, op):   # return the answer and the index of the ending ')'
            x, i = find(start)
            y, j = find(i+2)
            
            return ( x+y if op=='add' else x*y, j+1 )
        
        def let(start):           # return the answer and the index of the ending ')'  
            changed = {}          # this is to record those values changed in the current 'let'

            while True:
                x, i = find(start, False)
                
                if expression[i+1] == ')':      # the end of 'let' expression is reached 
                    temp = (values[x] if x in values else x, i+1)

                    for x in changed:           # this is to discard the changes we made to 'values' in the current 'let'
                        if changed[x] != None:
                            values[x] = changed[x]
                        else:
                            del values[x]

                    return temp
                
                y, j = find(i+2)

                changed[x] = values[x] if x in values else None
                values[x] = y
                
                start = j + 2
        
        values = {}
        return helper(1)[0]