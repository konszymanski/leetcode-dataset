class Solution:
    def numSquarefulPerms(self, A: List[int]) -> int:
        \'\'\'
        count full length paths in a graph with index i and j are connected if their
        sum is a perfect square.
        \'\'\' 
        
        n = len(A)
        G = defaultdict(set)
        
        def perfectSquare(i,j):
            y=A[i]+A[j]
            x= math.sqrt(y)
            x=int(x)
            return x*x==y
            
            
        for i in range(n):
            for j in range(i+1,n):
                if perfectSquare(i,j):
                    G[i].add(j)
                    G[j].add(i)
        self.ans = 0
        
        def dfs(i,path):
            path.append(i)
            if len(path)==n:
                self.ans+=1
            visited = set() #to account for duplicate values in A
            for j in G[i]:
                if j not in path and A[j] not in visited:
                    visited.add(A[j])
                    dfs(j,path)
                    path.pop()
                    
        seen = set() # we should not start with the same value twice
        for i in range(n):
            if A[i] not in seen:
                dfs(i,[])
                seen.add(A[i])
        
        return self.ans