class Solution(object):
    def recoverFromPreorder(self, S):
        """
        :type S: str
        :rtype: TreeNode
        """
        self.i = 0
        self.L = len(S)
        
        def build_tree(level):
            node = TreeNode(get_value())
            next_level = get_level()
            if next_level <= level:
                self.i -= next_level
                return node
            node.left = build_tree(next_level)
            next_level = get_level()
            if next_level <= level:
                self.i -= next_level
                return node
            node.right = build_tree(next_level)
            return node
            
        def get_level():
            level = 0
            while self.i < self.L and S[self.i] == \'-\':
                level += 1
                self.i+=1
            return level

        def get_value():
            val = ""
            while self.i < self.L and S[self.i] != \'-\':
                val += S[self.i]
                self.i+=1
            return val
        
        return build_tree(0)