class Solution:
    def minMalwareSpread(self, graph: List[List[int]], initial: List[int]) -> int:
        # Initiating Union Find
        numNodes, roots = len(graph), [node for node in range(len(graph))]
        
        def find(node: int) -> int:
            while roots[node] != node:
                roots[node] = roots[roots[node]]
                node = roots[node]
            return node
        
        # Consider non-malware nodes
        cleanNodes, initialSet, sizeOfEachGroup = [], set(initial), [0] * numNodes
        for node in range(numNodes):
            if node not in initialSet:
                cleanNodes.append(node)
        # Union Find on non-malware nodes
        for node1 in cleanNodes:
            for node2 in cleanNodes:
                if node1 != node2 and graph[node1][node2]:
                    roots[find(node1)] = find(node2)
        for node in cleanNodes:
            sizeOfEachGroup[find(node)] += 1
        # infectedNodes is malware -> nodes infected
        # infectedCount is node -> # of infecting malware
        infectedNodes, infectedCount = defaultdict(set), defaultdict(int)
        for infectedNode in initial:
            for cleanNode in cleanNodes:
                if graph[infectedNode][cleanNode]: 
                    infectedNodes[infectedNode].add(find(cleanNode))
            for otherInfectedNode in infectedNodes[infectedNode]:
                infectedCount[otherInfectedNode] += 1
        # Try removing each malware
        res, maxCount = initial[0], 0
        for startNode, nodes in infectedNodes.items():
            count = 0
            for infectedNode in nodes:
                # Removing startNode is only effective when node is infected by one malware
                if infectedCount[infectedNode] == 1:
                    count += sizeOfEachGroup[infectedNode]
            if count > maxCount or (count >= maxCount and startNode < res):
                maxCount, res = count, startNode
        return res