class Solution:
    def maxCandies(self, status: List[int], candies: List[int], keys: List[List[int]], containedBoxes: List[List[int]], initialBoxes: List[int]) -> int:
        q = [box for box in initialBoxes]
        count = 0
        unopened = set()
        while q:
            new_boxes = []
            for box in q:
                opened = status[box] == 1
                if opened:
                    count += candies[box]
                    if keys[box]:
                        for key in keys[box]: status[key] = 1
                    new_boxes.extend(containedBoxes[box])
                else:
                    if box in unopened: continue
                    unopened.add(box)
                    new_boxes.append(box)
            q = new_boxes
        return count