class Solution:
    def maxValueOfCoins(self, piles: List[List[int]], k: int) -> int:
        
        """
        . most optimized way to take K coins from pile to maximize output
        
        q. Is there a greedy way to find best coin to take
        a. No.. since top can havee low value and next value in sequence can have bettere answer, so we need lookahead, i.e DP
        
        bounded DP 
        
        """
        
        num_piles = len(piles)
        
        @cache
        def dp(remains, ci):
            
            if ci == num_piles:
                return 0
            
            if remains == 0:
                return 0
            
            
            
            m = -inf
            csum = 0
            used = 0
            for v in piles[ci]:
                csum += v
                used += 1
                m = max(m, csum + dp(remains-used, ci+1))
                
                if used == remains:
                    break
            
            return max(m, dp(remains, ci+1))
        
        return dp(k, 0)