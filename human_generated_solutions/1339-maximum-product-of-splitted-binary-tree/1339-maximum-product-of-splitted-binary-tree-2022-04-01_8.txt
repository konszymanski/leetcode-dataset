class Solution:
    def maxProduct(self, root: Optional[TreeNode]) -> int:
        def solve(root):
            if root.left:
                x=solve(root.left)
            else:
                x=0
            if root.right:
                y=solve(root.right)
            else:
                y=0
            root.val=x+y+root.val
            return root.val
            
        total=solve(root)
        queue=[root.left,root.right]
        ans=0
        while queue:
            node=queue.pop(0)
            if node:
                ans=max((total-node.val)*node.val,ans)
                queue.append(node.left)
                queue.append(node.right)
        return ans%(10**9 +7)