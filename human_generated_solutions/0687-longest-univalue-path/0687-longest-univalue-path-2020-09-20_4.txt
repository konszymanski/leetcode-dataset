# Definition for a binary tree node.
# class TreeNode:
#     def __init__(self, val=0, left=None, right=None):
#         self.val = val
#         self.left = left
#         self.right = right
class Solution:
    def longestUnivaluePath(self, root: TreeNode) -> int:
        if root is None:
            return 0
        if root.left is None and root.right is None:
            return 0
        return self.longpaths(root)[2]
                
    def longpaths(self, node):
        left, right, main = 0, 0, 0
        flag = False
        if node.right is not None:
            l, r, m = self.longpaths(node.right)
            if m > main:
                main = m
            if node.right.val == node.val:
                right = max([l, r]) + 1
                if right > main:
                    main = right
                flag = True
        
        if node.left is not None:
            l, r, m = self.longpaths(node.left)
            if m > main:
                main = m
            if node.left.val == node.val:
                left = max([l, r]) + 1
                if left > main:
                    main = left
                if flag:
                    if left + right > main:
                        main = left + right
        return left, right, main