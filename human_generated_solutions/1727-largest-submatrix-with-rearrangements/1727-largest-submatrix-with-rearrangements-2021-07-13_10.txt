class Solution:
    def largestSubmatrix(self, matrix) -> int:
        rows, cols = len(matrix), len(matrix[0])
        max_fit = max(sum(row) for row in matrix)

        for r in range(1, rows):
            for c in range(cols):
                if matrix[r - 1][c] and matrix[r][c]:
                    matrix[r][c] += matrix[r - 1][c]
        for r in range(rows):
            matrix[r].sort()

        for row in matrix:
            start = end = -1
            for c, v in enumerate(row):
                if v:
                    if start < 0:
                        start = end = c
                    else:
                        end = c
                else:
                    if start > -1:
                        for sub_start in range(start, end + 1):
                            height = row[start]
                            if height * (end + 1 - sub_start) <= max_fit:
                                continue
                            count_cols = 0
                            for sub_end in range(sub_start, end + 1):
                                if row[sub_end] >= height:
                                    count_cols += 1
                                else:
                                    break
                            max_fit = max(max_fit, height * count_cols)
                    start = end = -1
            if start > -1:
                for sub_start in range(start, end + 1):
                    height = row[sub_start]
                    if height * (end + 1 - sub_start) <= max_fit:
                        continue
                    count_cols = 0
                    for sub_end in range(sub_start, end + 1):
                        if row[sub_end] >= height:
                            count_cols += 1
                        else:
                            break
                    max_fit = max(max_fit, height * count_cols)
        return max_fit