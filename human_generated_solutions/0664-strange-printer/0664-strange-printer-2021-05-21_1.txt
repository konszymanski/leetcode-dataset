class Solution:
	def strangePrinter(self, s: str) -> int:
		# Our working string can be treated as initially equal to repeated \'#\'

		# Merge consecutive characters
		s = \'\'.join([c for i, c in enumerate(s)
					 if i == 0 or c != s[i - 1]])

		# Track index where each letter occurs next, for faster lookup
		next_occ_search = {}
		next_occurrence_of_letter = list(range(len(s)))
		for i, c in enumerate(s):
			if c in next_occ_search:
				next_occurrence_of_letter[next_occ_search[c]] = i
			next_occ_search[c] = i

		for v in next_occ_search.values():
			next_occurrence_of_letter[v] = 10**10

		# dp(left_ind, right_ind) is minimum steps to convert a string of
		# repeated s[right_ind] into s[left_ind:right_ind]
		# Note the python half open interval: [left_ind, right_ind)
		@functools.lru_cache(None)
		def dp(left_ind: int, right_ind: int) -> int:

			# Nothing to print
			if left_ind >= right_ind:
				return 0

			# s[left_ind] is already the desired character
			if s[right_ind] == s[left_ind]:
				return dp(left_ind + 1, right_ind)

			# If our pivot index is left_ind
			ans = 1 + dp(left_ind + 1, right_ind)

			pivot_index = next_occurrence_of_letter[left_ind]
			while pivot_index <= right_ind:
				ans = min(ans, 1 + dp(left_ind + 1, pivot_index)
						  + dp(pivot_index + 1, right_ind))
				pivot_index = next_occurrence_of_letter[pivot_index]

			return ans

		s += \'#\'
		return dp(0, len(s) - 1)