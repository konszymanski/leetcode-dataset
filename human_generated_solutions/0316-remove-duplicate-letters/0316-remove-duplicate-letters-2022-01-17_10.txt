from collections import Counter, defaultdict


class Solution:
    def removeDuplicateLetters(self, s: str) -> str:
        counts = Counter(s)  # Count number of occurrences of each char in s
        used = defaultdict(bool)  # Find if specific char is already pushed onto stack
        mono_stack = []  # Monotonically Increasing Stack (Top elements > Bottom elements)

        for char in s:
            # Always decrement count of current char
            counts[char] -= 1

            # If char is already used before, no need to append it again
            if used[char]:
                continue
				
            # Check if char is less than top element of stack (if so, it cannot be appended on the top)
            # And pop top char only if there are more occurrences of it left in the string
            while mono_stack and char <= mono_stack[-1] and counts[mono_stack[-1]] != 0:
                this_char = mono_stack.pop(-1)
                used[this_char] = False

            # Append current char onto the stack
            used[char] = True
            mono_stack.append(char)

        # Elements of the stack is the final string
        return "".join(mono_stack)