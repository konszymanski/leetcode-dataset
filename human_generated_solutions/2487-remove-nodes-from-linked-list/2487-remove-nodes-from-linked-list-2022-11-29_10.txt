class Solution:
    def removeNodes_v1(self, head: Optional[ListNode]) -> Optional[ListNode]:
        """
        v1: verbose solution for details and intuition
        Write with some redundancy.
        """
        
        # 1. get the val list
        aux = []
        idx = 0
        while head:
            aux.append(head.val) # aux.append((head.val, idx))
            idx += 1
            head = head.next
        
        n = idx # n is nothing but the linked list length
        
        # 2. maintain a nondecreasing stack
        stack = []
        for i in range(n-1, -1, -1):
            if not stack:
                stack.append(aux[i])
            else:
                if aux[i] < stack[-1]:
                    continue
                else:
                    stack.append(aux[i])
        
        # 3. build the return
        dummy = ListNode(0)
        cur = dummy
        while stack:
            val = stack.pop()
            tmp = ListNode(val=val)
            cur.next = tmp
            cur = tmp
        
        return dummy.next
    
    
    def removeNodes(self, head: Optional[ListNode]) -> Optional[ListNode]:
        """
        v2: in-place ops
        """
        # 1. reverse the linked list
        prev = None
        cur = head
        while cur:
            follower = cur.next
            cur.next = prev
            prev = cur
            cur = follower
        new_head = prev
        
        # 2. removals
        dummy = ListNode(val=0, next=new_head)
        prev = dummy
        cur = new_head
        while cur:
            if cur.val >= prev.val:
                prev = cur
                cur = cur.next
            else:
                tmp = cur.next
                prev.next = tmp
                cur = tmp
        reversed_linked_list = dummy.next
        
        # 3. reverse back
        prev = None
        cur = reversed_linked_list
        while cur:
            tmp = cur.next
            cur.next = prev
            prev = cur
            cur = tmp
            
        return prev