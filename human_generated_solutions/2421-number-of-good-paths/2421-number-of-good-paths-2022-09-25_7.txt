class Solution:
    def numberOfGoodPaths(self, V: List[int], E: List[List[int]]) -> int:
        mat = defaultdict(list)
        
        for x, y in E:
            if V[y] <= V[x]: mat[x].append(y)
            if V[x] <= V[y]: mat[y].append(x)
        
        n = len(V)
        parent = list(range(n))
        
        def find(node):
            if parent[node] == node:
                return node
            parent[node] = find(parent[node])
            return parent[node]
        
        dic = defaultdict(dict)
        ans = n
        
        for node, val in enumerate(V):
            dic[node][val] = 1

        for val, node in sorted([val, node] for node, val in enumerate(V)):
            for nei in mat[node]:
                pnode, pnei = find(node), find(nei)
                if pnei != pnode:
                    parent[pnei] = node # union
                    ans += dic[pnode][val] * dic[pnei].get(val, 0)
                    dic[pnode][val] = dic[pnei].get(val, 0) + dic[pnode][val]
		
        return ans