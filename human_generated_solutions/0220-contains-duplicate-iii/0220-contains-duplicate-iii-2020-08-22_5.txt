import sortedcontainers
class Solution:
    def containsNearbyAlmostDuplicate(self, nums: List[int], k: int, t: int) -> bool:
        
        def floor(n, bst):
            le = bst.bisect_right(n) - 1
            return bst[le] if le >= 0 else None
        
        def ceiling(n, bst):
            ge = bst.bisect_right(n)
            return bst[ge] if ge < len(bst) else None
        
        bst = sortedcontainers.SortedList()
        for i, n in enumerate(nums):
            le = floor(n, bst)
            if le is not None and n <= le + t:
                return True
            ge = ceiling(n, bst)
            if ge is not None and ge <= n + t:
                return True
            bst.add(n)
            if len(bst) > k:
                bst.remove(nums[i-k])
        return False
    # time:  O(nlogk)
    # space: O(k)