from collections import defaultdict, deque

class Solution:
    def calcEquation(self, equations: List[List[str]], values: List[float], queries: List[List[str]]) -> List[float]:
        
        graph = defaultdict(list)
        unique_var = set()
        
        # Building the graph
        i = 0
        for a, b in equations:
            unique_var.add(a)
            unique_var.add(b)
            graph[a].append((b, values[i]))
            graph[b].append((a, 1/values[i]))
            i += 1
            
        
        def findValue(a, b):
            """
            Find the shortest path between two nodes (variables) in the graph. As we are traversing the graph we will multiply the value of each edge. The final value of the last edge will be the answer of a/b
            """
            q = deque()
            seen = set()
            q.appendleft((a, 1.0))
            
            while q:
                var, val = q.pop()
                seen.add(var)
                
                if var == b:
                    return val
                
                for next_, v in graph[var]:
                    if next_ not in seen:
                        q.appendleft((next_, v*val))
                        
            return -1.0
        
        
        res = []
        for a, b in queries:
            if a not in unique_var or b not in unique_var:
                res.append(-1.0)
                continue
            elif a == b:
                res.append(1.0)
                continue
                
            val = findValue(a, b)
            res.append(val)
            
        return res