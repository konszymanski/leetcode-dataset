class Solution:
    def calcEquation(self, equations: List[List[str]], values: List[float], queries: List[List[str]]) -> List[float]:
        parents = {}
        ratio = {}
        
        def find(x):
            if parents[x] != x:
                ratio[x] *= ratio[parents[x]]
                parents[x] = find(parents[x])
            return parents[x]
        
        def union(x, y, k):
            rx = find(x)
            ry = find(y)
            if rx != ry:
                parents[rx] = ry
                ratio[rx] = k * (ratio[y] / ratio[x])
        
        for (A, B), k in zip(equations, values):
            if A not in parents and B not in parents:
                parents[A] = B
                parents[B] = B
                ratio[A] = k
                ratio[B] = 1.0
            elif A in parents and B in parents:
                union(A, B, k)
            elif A in parents and B not in parents:
                ra = find(A)
                parents[B] = ra
                ratio[B] = 1 / k * ratio[A]
            elif A not in parents and B in parents:
                rb = find(B)
                parents[A] = rb
                ratio[A] = k * ratio[B]
                
        res = []
        for x, y in queries:
            if x not in parents or y not in parents:
                res.append(-1.0)
                continue
            rx = find(x)
            ry = find(y)
            if rx != ry:
                res.append(-1.0)
            else:
                res.append(ratio[x] / ratio[y])
                
        return res