class Solution:
    def calcEquation(self, eq: List[List[str]], val: List[float], Q: List[List[str]]) -> List[float]:
        graph = self.buildGraph(eq, val)
        ans = []
        for q in Q:
            src = q[0]
            dst = q[1]
            if src not in graph or dst not in graph:
                ans.append(-1.0)
            else:
                visited = set()
                temp = 1.0
                self.dfs(graph, src, dst, visited, temp)
                ans.append(temp)
        return ans

    def dfs(self, graph: Dict[str, Dict[str, float]], src: str, dst: str, visited: Set[str], temp: float) -> None:
        if src in visited:
            return
        if src == dst:
            return
        visited.add(src)
        for u, w in graph[src].items():
            temp *= w
            self.dfs(graph, u, dst, visited, temp)
            if temp != 0.0 and u == dst:
                return
            temp /= w

    def buildGraph(self, eq: List[List[str]], val: List[float]) -> Dict[str, Dict[str, float]]:
        graph = defaultdict(dict)
        for i in range(len(eq)):
            u, v = eq[i]
            w = val[i]
            graph[u][v] = w
            graph[v][u] = 1.0 / w
        return graph