from collections import deque, defaultdict
class Solution:
    def calcEquation(self, equations: List[List[str]], values: List[float], queries: List[List[str]]) -> List[float]:
        graph = defaultdict(list)
        
        # Build an Undirected Graph. 
        for i, (u, v) in enumerate(equations):
            graph[u].append((v, values[i]))
            graph[v].append((u, 1/values[i])) # Inverse of u->v
        
        def bfs(query):
            q = deque([])
            
            src, dest = query
            q.append((src, 1))
            visited = set()
            
            if src not in graph or dest not in graph:
                return -1
            
            while q:
                u, current_val = q.popleft()
                visited.add(u)
                if u == dest: 
                    return current_val
                
                for v, val in graph[u]:
                    if v not in visited:
                        q.append((v, current_val*val))                 
              
            return -1
                
        return [bfs(q) for q in queries]