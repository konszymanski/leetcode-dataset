import collections
class Solution:
    def calcEquation(self, equations: List[List[str]], values: List[float], queries: List[List[str]]) -> List[float]:
        res = []
        graph = collections.defaultdict(dict)
        for (x,y), r in zip(equations, values):
            graph[x][y] = r
            graph[y][x] = 1/r
            
        for m, n in queries:
            if m not in graph:
                res.append(-1.0)
            else:
                res.append(self.dfs(m, n, graph, set()))
        return res
    
    def dfs(self, x, y, graph, visited):
        if x not in graph:
            return -1.0
        if x == y:
            return 1
        visited.add(x)
        for nxt in graph[x]:
            if nxt not in visited:
                v = self.dfs(nxt, y, graph, visited)
                if v != -1:
                    return graph[x][nxt]*v
        return -1