class Solution:
    def calcEquation(self, equations: List[List[str]], values: List[float], queries: List[List[str]]) -> List[float]:
        res = [-1.0 for i in range(len(queries))]
        graph = collections.defaultdict(list)

        for source, dest in equations:
            graph[source].append(dest)
            graph[dest].append(source)
        
        hashmap = {tuple(equations[i]) : values[i] for i in range(len(equations))}
        hashmapRev = {tuple([equations[i][1],equations[i][0]]) : 1.0/values[i] for i in range(len(equations))}
        hashmap.update(hashmapRev)

        for i,q in enumerate(queries):
            q = tuple(q)
            if q in hashmap:
                res[i] = hashmap[q]
            else:
                source, dest = q
                if source not in graph:
                    res[i] = -1
                    continue
                visited = set()
                visited.add(source)

                queue = collections.deque()
                queue.append((source,1))

                while queue:
                    removed, div = queue.popleft()
                    if removed == dest:
                        res[i] = div
                        break
                    for child in graph[removed]:
                        if child not in visited:
                            visited.add(child)
                            queue.append((child,div*hashmap[(removed,child)]))

        return res