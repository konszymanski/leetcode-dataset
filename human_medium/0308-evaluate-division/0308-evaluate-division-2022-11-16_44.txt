from collections import defaultdict

class Solution:
    def calcEquation(self, equations: List[List[str]], values: List[float], queries: List[List[str]]) -> List[float]:
        graph = defaultdict(dict)
        for (a, b), v in zip(equations, values):
            graph[a][a], graph[b][b], graph[a][b], graph[b][a] = 1, 1, v, 1/v
            # Fully connect group a and b
            ga, gb = list(graph[a].keys()), list(graph[b].keys())
            for aa in ga:
                for bb in gb:
                    graph[aa][bb] = graph[aa][a] * graph[a][b] * graph[b][bb]
                    graph[bb][aa] = 1/graph[aa][bb]
        return [graph[a][b] if a in graph and b in graph[a] else -1 for a, b in queries]