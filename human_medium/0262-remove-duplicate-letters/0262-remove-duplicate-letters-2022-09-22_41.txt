class Solution:
    def removeDuplicateLetters(self, s: str) -> str:
        # Questions:
        # - Is s only consists of lowercase English letters?
        
        stack = []  
        # A stack to save the result ordering
        # NOTE: stack FILO, so the original ordering is kept.
        
        counter = Counter(s)
        # The remaining occurrences of each letter
        
        inStack = {chr(c): False for c in range(ord(\'a\'), ord(\'z\')+1)}
        # Whether a char exists in the stack; to decide whether to push a char
        
        for c in s:
            # No matter whether c is in stack, counter should decrease
            # because it is corresponding to the rest (untraversed) part of s.
            counter[c] -= 1
            # If already in stack, skip
            if inStack[c]:
                continue
            
            while len(stack) > 0 and stack[-1] > c and counter[stack[-1]] > 0:
                # The top of stack is large then `c` and it occurs later in the string
                # So it is safe to replace the current one and use the later one.
                top = stack.pop()
                inStack[top] = False
                
            stack.append(c)
            inStack[c] = True
        
        return "".join(stack)
    
    # T(N) = O(N)
    # - the inner while loop is limited by how many elements are currently in the stack
    # S(N) = O(N) + O(26) = O(N)