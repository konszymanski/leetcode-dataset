class TreeNodeWithSize:
    def __init__(self,val,size):
        self.val=val
        self.size=size
        self.removed=False
        self.left=None
        self.right=None

class IndsBST:
    def __init__(self,n):
        self.root=self.constructBST(0,n)

    def constructBST(self,start,end):
        if start>=end:
            return None
            
        mid=(start+end)//2
        root=TreeNodeWithSize(mid,end-start)
        root.left=self.constructBST(start,mid)
        root.right=self.constructBST(mid+1,end)
        return root
    
    def getKthNodeIndex(self,k):
        return self._getKthNodeIndex(k,self.root)
        
    def _getKthNodeIndex(self,k,root):
        
        leftSize= root.left.size if root.left else 0
        root.size-=1 #reduce size of this node
        if k==leftSize and not root.removed: #found node
            root.removed=True
            return root.val
        if k>=leftSize: #go right
            return self._getKthNodeIndex(k-leftSize-int(not root.removed),root.right)
        else:
            return self._getKthNodeIndex(k,root.left)
        
class Solution:
    
    def reconstructQueue(self, people: List[List[int]]) -> List[List[int]]:
        
        people=sorted(people,key=lambda person: person[1],reverse=True)
        people=sorted(people,key=lambda person: person[0])
        
        out=[None]*len(people)
        indsTree=IndsBST(len(people))
        
        for person in people:
            out[indsTree.getKthNodeIndex(person[1])]=person
        return out