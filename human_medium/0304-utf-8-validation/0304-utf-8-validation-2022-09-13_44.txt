class Solution:
    def validUtf8(self, data: List[int]) -> bool:
        idx = 0
        while idx < len(data):
            buf = data[idx]
            n = 1
            while buf & 0x80 != 0:
                buf <<= 1
                n += 1

            if n == 1:
                idx += 1
                continue
            elif n == 2:
                return False
            elif n >= 3 and n <= 5:
                # n >= 3
                n -= 1
            else:
                return False

            for j in range(idx + 1, idx + n):
                if j >= len(data):
                    return False

                if data[j] & 0xc0 != 0x80:
                    return False

            idx += n

        return True