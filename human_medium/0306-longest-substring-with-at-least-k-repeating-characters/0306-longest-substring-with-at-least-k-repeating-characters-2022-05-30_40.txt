class Solution:
    def longestSubstring(self, s: str, k: int) -> int:
        # count the number of occurrence of each charactor
        counts = {}
        candidates = set()
        for char in s:
            if char not in counts:
                counts[char] = 0
            counts[char] += 1
            if counts[char] >= k:
                candidates.add(char)
        # if no char has occurrence more than k, return 0
        if len(candidates) == 0:
            return 0
        # trim the left side and right side
        left, right = 0, len(s) - 1
        while s[left] not in candidates:
            left += 1
        while s[right] not in candidates:
            right -= 1
        if all(char in candidates for char in s[left : right + 1]):
            return right - left + 1      # so the whole substring is built with "good" chars
        i = left
        while i < right:       # else we split it into two substrings and get the max recursively
            if s[i] not in candidates:
                maxLeft = self.longestSubstring(s[left : i], k)
                maxRight = self.longestSubstring(s[i+1 : right+1], k)
                return max(maxLeft, maxRight)
            i += 1