class Solution:
    def longestSubstring(self, s: str, k: int) -> int:
        N = len(s)
        
        char_freq = Counter(s)
        
        max_len = 0
        for max_allowed_unique_chars in range(1, len(char_freq.keys()) + 1):
            char_freq = defaultdict(int)
            
            current_unique_chars = 0
            start = 0
            for end in range(N):
				# add new char to the window
                char_freq[s[end]] += 1
                
                if char_freq[s[end]] == 1:
                    current_unique_chars += 1
                
                while current_unique_chars > max_allowed_unique_chars:				
					# remove chars until we get current_unique_chars == max_allowed_unique_chars
                    char_freq[s[start]] -= 1
                    
                    if char_freq[s[start]] == 0:
                        del char_freq[s[start]]
                        current_unique_chars -= 1
                    
                    start += 1

				# are all char_freqs >= k?
                if all(v >= k for v in char_freq.values()):
                    max_len = max(max_len, end - start + 1)
        
        return max_len