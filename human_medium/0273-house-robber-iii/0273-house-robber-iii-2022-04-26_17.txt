class Solution:
    def rob(self, root: Optional[TreeNode]) -> int:
        
        memo = {}
        
        def dfs(root):
            if not root:
                return 0
        
            if root in memo.keys():
                return memo.get(root)
        
            left = 0 if not root.left else dfs(root.left.left) + dfs(root.left.right)
            right = 0 if not root.right else dfs(root.right.left) + dfs(root.right.right)

            do_root = root.val + left + right
            not_do_root = dfs(root.left) + dfs(root.right)

            res = max(do_root, not_do_root)
            
            memo[root] = res
            
            return res
        
        return dfs(root)