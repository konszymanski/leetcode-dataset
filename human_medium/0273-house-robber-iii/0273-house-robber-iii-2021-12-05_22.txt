class Solution:
    def rob(self, root: Optional[TreeNode]) -> int:
        
        @cache
        def rec(root, withRoot):
            if not root:
                return 0
            
            left, right = root.left, root.right
            
            res = 0
            if withRoot:
                res = root.val + rec(left, False) + rec(right, False)
            else:
                res = max(rec(left, False), rec(left, True)) +  max(rec(right, False), rec(right, True))
            
            return  res
 
        return max(rec(root, True), rec(root, False))