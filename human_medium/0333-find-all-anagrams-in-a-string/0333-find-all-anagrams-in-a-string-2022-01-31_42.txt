class Solution:
# BRUTE FORCE
#     def findAnagrams(self, s: str, p: str) -> List[int]:
        
#         solution = []
        
#         sorted_p = sorted(p)
#         for i in range(len(s) - len(p)):
#             sub_s = s[i:i+len(p)]
#             if sorted_p == sorted(sub_s):
#                 solution.append(i)
                
#         return solution

# Real O(N) solution both time and space
# A lot of posted solutions are actually O(NP) because 
# at each step they check if the occurrences of each char in p
# are the same as the ones in the window, but this takes p steps!
# This solution avoid checking the occurrences at each steps by keeping
# track of the difference between the window and p, so only two checks should be made
# per step.
    def findAnagrams(self, s: str, p: str) -> List[int]:
        
        solution = []
        
        # Stores the differences for each char between the counts in the sliding window and p
        # a positive entry k means that in the window there are k occurrences of that char missing compared to p
        # a negative entry k means that in the window there are k occurrences of that char in excess compared to p
        diff_cnts = defaultdict(int)
        for c_p in p:
            diff_cnts[c_p] = diff_cnts[c_p] + 1
            
        # Integer that keeps track of how many differences there are in the two strings 
        num_diff = len(p)
        for c_s in s[:len(p)]:
            if c_s in diff_cnts:
                diff_cnts[c_s] -= 1
                # if while decreasing the count for that char we go below zero
                # this means that we have one occurrence more of that char in our window
                # hence the difference should not decrease
                num_diff -= 1 if diff_cnts[c_s] >= 0 else 0
                
        if num_diff == 0:
                solution.append(0)
  
        for idx_c_s in range(1, len(s)-len(p)+1):

            c_s = s[idx_c_s - 1]
            if c_s in diff_cnts:
                diff_cnts[c_s] += 1
                
                # If we are incrementing the count from a negative number this means that 
                # we are deleting an excess in the window for that particular char, hence difference
                # do not increase
                num_diff += 1 if diff_cnts[c_s] > 0 else 0
                
            
            c_s = s[idx_c_s + len(p) - 1]
            if c_s in diff_cnts:
                diff_cnts[c_s] -= 1
                num_diff -= 1 if diff_cnts[c_s] >= 0 else 0

            if num_diff == 0:
                solution.append(idx_c_s)
                
        return solution