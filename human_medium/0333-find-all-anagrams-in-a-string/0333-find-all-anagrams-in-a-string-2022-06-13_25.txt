from collections import Counter, defaultdict

class Solution:
    def findAnagrams(self, s: str, p: str) -> List[int]:
        if len(p) > len(s): return []
        
        p_counter = defaultdict(int)
        window_length = len(p)
        window_counter = defaultdict(int)
        output = []
        for c in p: p_counter[c] += 1
        missing_anagram_letters = len(p_counter) 
        
        # Run first time to initialize window data
        for i in range(window_length):
            current_char = s[i]
            window_counter[current_char] += 1
            if current_char in p_counter and p_counter[current_char] == window_counter[current_char]:
                missing_anagram_letters -= 1
        
        if missing_anagram_letters == 0: output.append(0)
        
        # Run over all windows
        for i in range(1, len(s) - window_length + 1):
            prev_window_char = s[i-1]
            newly_added_window_char = s[i + window_length - 1]
            
            if prev_window_char in p_counter and p_counter[prev_window_char] == window_counter[prev_window_char]:
                missing_anagram_letters += 1
            window_counter[prev_window_char]-= 1
            
            window_counter[newly_added_window_char] += 1
            if newly_added_window_char in p_counter and p_counter[newly_added_window_char] == window_counter[newly_added_window_char]:
                missing_anagram_letters -= 1
            
            if missing_anagram_letters == 0: output.append(i)
        
        return output