class Solution:
    def flatten(self, head: \'Optional[Node]\') -> \'Optional[Node]\':
        def merge(node, near):
            if node.child == None:
                if near: merge(near, near.next)
            else:
                child = node.child
                child.prev = node
                node.next = child
                node.child = None
                while child.next: child = child.next
                child.next = near
                if near: near.prev = child
                merge(node.next, node.next.next)
        if head != None: merge(head, head.next)
        return head