"""
# Definition for a Node.
class Node:
    def __init__(self, val, prev, next, child):
        self.val = val
        self.prev = prev
        self.next = next
        self.child = child
"""
class Solution:
    def flattenList(self, head):
        if not head.next and not head.child: # the backmost node (both main or child)
            return head
        
        if head.child: # find the backmost node if there is a child
            temp_next = head.next # save the next node for later being appended with the backmost node of the child
            head.next = head.child
            head.child.prev = head
            head.child = None
            
            back = self.flattenList(head.next) # find the backmost node of the child
            back.next = temp_next
            if temp_next: # prevent next main node is None
                temp_next.prev = back
            head = back # set the new head
            
        if head.next: # continue finding the backmost node
            return self.flattenList(head.next)
        else:
            return head
        
    def flatten(self, head: \'Node\') -> \'Node\':
        if not head:
            return head
        self.flattenList(head)
        return head