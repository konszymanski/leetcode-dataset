class Solution:
    def flatten(self, head: \'Node\') -> \'Node\':
        if not head: return head
        
        ptr = head
        stack = [None]
        
        while ptr:
            if ptr.child:
                stack.append(ptr.next)
                ptr.next = ptr.child
                ptr.next.prev = ptr
                ptr.child = None
            if not ptr.next:
                x = stack.pop()
                ptr.next = x
                if x: x.prev = ptr
                    
            ptr = ptr.next
            
        return head