class Solution(object):
  def flatten(self, head):
    stack = []
    index = head
    while index:
      if index.child:
        index.next and stack.append(index.next)
        index.next = index.child
        index.next.prev = index
        index.child = None
      if not index.next and len(stack) > 0:
        index.next = stack.pop()
        index.next.prev = index
      index = index.next
    return head