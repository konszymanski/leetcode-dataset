class Solution:
    def productExceptSelf(self, nums: List[int]) -> List[int]:
        """O(n) without division with O(1) space"""
        
        total = 1
        current_total = 1
        number_of_zeros = 0
        output = [None]
        for index, value in enumerate(nums):
            if value:
                total *= value
            else:
                number_of_zeros += 1
                
            if index:
                current_total *= nums[index-1]
                output.append(current_total)
		
		# Case when all the elements in nums are zero
		# We are sure about this coz we skiped multiplying 0 when calculating total
        if total == 0:
            return nums
        
		# When there are more than 1 zeros, all the resulting elemetns will be 0 for sure
        if number_of_zeros > 1:
            return [0 for _ in nums]
        
		# When there is only 1 zero, the zero index will be the total and all the other indices will be 0
        if number_of_zeros == 1:
            return [total if value == 0 else 0 for value in nums]
        
        past_total = 1
        for current_index in range(len(nums)-1, -1, -1):
            if current_index != len(nums) - 1:
                past_total *= nums[current_index+1]
                if current_index:
                    output[current_index] *= past_total
                else:
                    output[current_index] = past_total
        
        return output