class Solution:
    def maximalSquare(self, matrix: List[List[str]]) -> int:
        
        m = len(matrix)
        n = len(matrix[0])
        
        rols = []
        maxsqlen = 0
        # turn each row into a number 
        # time O(mn)
        for r in range(m):
            v = 0
            for c in range(n-1,-1,-1):
                v += int(matrix[r][c]) << (n - c - 1)
            if v > 0: # there are at least one 1
                maxsqlen = 1
            rols.append(v)
        
        # iterate each value at ith againt the rest (i+1 to m-1)
        for (i, n) in enumerate(rols):
            # pruning when the rest operation cannot find a L which is greater than maxsqlen
            if maxsqlen >= m - i:
                break
            for j in range(i+1,m):
                n &= rols[j]
                L = j - i + 1
                # if there is a squre in the rows between i and j,
                # which the length is graeter than L, 
                # there must be at least L consectutive 1 bits.
                if self.longestConsectutive1Bits(n) < L:
                    break
                maxsqlen = max(maxsqlen, L)
        return maxsqlen * maxsqlen
    
    def longestConsectutive1Bits(self, n):
        c = 0
        while n:
            n &= n << 1
            c += 1
        return c