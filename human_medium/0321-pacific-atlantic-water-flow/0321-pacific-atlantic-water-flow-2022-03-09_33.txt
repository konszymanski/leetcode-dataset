class Solution:
    def pacificAtlantic(self, heights: List[List[int]]) -> List[List[int]]:
        def getOceanDrainage(heights, isOnSoutheast):
            m, n = len(heights), len(heights[0])
            drainage = set([(i,n-1 if isOnSoutheast else 0) for i in range(m)] + [(m-1 if isOnSoutheast else 0, j) for j in range(n)])
            prevDrainage = drainage
            while prevDrainage:
                newDrainage = set()
                for (i,j) in prevDrainage:
                    neighbors = ([(i-1,j)] if i>0 else []) + ([(i+1,j)] if i+1<m else []) + ([(i,j-1)] if j>0 else []) + ([(i,j+1)] if j+1<n else [])
                    for ni,nj in neighbors:
                        if (ni,nj) not in drainage and (ni,nj) not in newDrainage and heights[ni][nj] >= heights[i][j]:
                            newDrainage.add((ni,nj))
                drainage |= newDrainage
                prevDrainage = newDrainage
            return drainage
        pacific = getOceanDrainage(heights, False)
        atlantic = getOceanDrainage(heights, True)
        return pacific & atlantic