from collections import deque

class Solution:
    def isValid(self, x, y, heights):
        m = len(heights)
        n = len(heights[0])
        
        return 0 <= x < m and 0 <= y < n
    
    def bfs(self, queue, heights):
        directions = [[-1, 0], [1, 0], [0, 1], [0, -1]]
        
        marked = set()
        
        while queue:
            coordinates = queue.popleft()
            x = coordinates[0]
            y = coordinates[1]
            
            marked.add((x, y))    
            
            for direction in directions:
                xNew = x + direction[0]
                yNew = y + direction[1]
                
                if self.isValid(xNew, yNew, heights) and heights[xNew][yNew] >= heights[x][y] and (xNew, yNew) not in marked:
                    queue.append((xNew, yNew))
        return marked
    
    def pacificAtlantic(self, heights: List[List[int]]) -> List[List[int]]:
        m = len(heights)
        n = len(heights[0])
        
        pacificQueue = deque()
        atlanticQueue = deque()        
        
        for i in range(m):
            pacificQueue.append((i, 0))
            atlanticQueue.append((i, n - 1))            

            
        for j in range(n):
            pacificQueue.append((0, j))
            atlanticQueue.append((m - 1, j))            
            
        pacific = self.bfs(pacificQueue, heights)
        atlantic = self.bfs(atlanticQueue, heights)            
        return list(pacific.intersection(atlantic))