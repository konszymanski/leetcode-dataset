class Solution:
    def pacificAtlantic(self, heights: List[List[int]]) -> List[List[int]]:
        ROWS, COLS = len(heights), len(heights[0])
        
        pacificQueue, atlanticQueue = deque(), deque()
        
        for col in range(COLS):
            pacificQueue.append((0, col, heights[0][col]))
            atlanticQueue.append((ROWS-1, col, heights[ROWS-1][col]))
        
        for row in range(ROWS):
            pacificQueue.append((row, 0, heights[row][0]))
            atlanticQueue.append((row, COLS-1, heights[row][COLS-1]))
        
        directions = [(0, 1), (1, 0), (0, -1), (-1, 0)]
        
        def bfs(queue):
            reachable = set()
            while queue:
                for _ in range(len(queue)):
                    r, c, level = queue.popleft()
                    reachable.add((r, c))

                    for dr, dc in directions:
                        nr, nc = r + dr, c + dc

                        if (nr < 0 or nr >= ROWS or 
                            nc < 0 or nc >= COLS or 
                            heights[nr][nc] < level or 
                            (nr, nc) in reachable):
                            continue

                        queue.append((nr, nc, heights[nr][nc]))
            return reachable
                    
        atlanticReachable = bfs(atlanticQueue)
        pacificReachable = bfs(pacificQueue)

        return list(atlanticReachable.intersection(pacificReachable))