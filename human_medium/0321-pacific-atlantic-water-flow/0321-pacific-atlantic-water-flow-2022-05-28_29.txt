from collections import deque

class Solution:
    def pacificAtlantic(self, heights: List[List[int]]) -> List[List[int]]:
        """
        Approach:
        
        Do Breath First Search (BFS) twice
        
        1. Collect all nodes that can reach Pacific ocean
            1a. Start BFS with all nodes on the left and top edges, all visited nodes in the traversal can reach Pacific Ocean. 
			1b. The neighbouring node must have an equal or higher height.
        2. Collect all nodes that can reach Atlantic ocean
            2a. Start BFS with all nodes on the right and bottom edges, all visited nodes in the traversal can reach Atlantic Ocean.
			2b. The neighbouring node must have an equal or higher height.
        3. Calculate the intersection of the two sets.
        
        Time: O(|V| + |E|) = O(mn)
        Space: O(|V|) = O(mn)
        """
        NUM_ROWS = len(heights)
        NUM_COLS = len(heights[0])
        can_reach_pac = set()
        can_reach_atl = set()
        
        self.bfs([(0,i) for i in range(NUM_COLS)] + [(i,0) for i in range(NUM_ROWS)],
                 heights, can_reach_pac)
        self.bfs([(NUM_ROWS-1,i) for i in range(NUM_COLS)] + [(i,NUM_COLS-1) for i in range(NUM_ROWS)],
                 heights, can_reach_atl)
        
        both_can_reach = can_reach_atl.intersection(can_reach_pac)
        
        return both_can_reach
        
    def bfs(self, nodes, heights, visited):
        NUM_ROWS = len(heights)
        NUM_COLS = len(heights[0])
        directions = [(1,0), (-1,0), (0,-1), (0,1)]
        queue = deque(nodes)
        
        while len(queue) > 0:
            curr_i, curr_j = queue.popleft()
            
            if (curr_i, curr_j) not in visited:
                visited.add((curr_i, curr_j))
                
                for dir_i, dir_j in directions:
                    nbr_i, nbr_j = curr_i + dir_i, curr_j + dir_j
                    
                    if 0 <= nbr_i < NUM_ROWS and 0 <= nbr_j < NUM_COLS:
                        if heights[nbr_i][nbr_j] >= heights[curr_i][curr_j]:
                            queue.append((nbr_i,nbr_j))