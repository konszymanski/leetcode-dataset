class Solution:
    def pacificAtlantic(self, matrix):
        if len(matrix) == 0:
            return []

        m, n = len(matrix), len(matrix[0])

        def height(tile):
            (i, j) = tile
            return matrix[i][j]
        
        def neighbours(tile):
            (i, j) = tile
            return [
                (i + a, j + b)
                for (a, b) in [(-1, 0), (1, 0), (0, -1), (0, 1)]
                if 0 <= i + a < m
                if 0 <= j + b < n
            ]

        def find_basin(drains):
            queue = drains
            basin = set()
            while queue:
                tile = queue.pop()
                basin.add(tile)
                queue.update(
                    nb
                    for nb in neighbours(tile)
                    if nb not in basin
                    if height(nb) >= height(tile)
                )
            return basin

        top_edge    = set((  0,   j) for j in range(n))
        right_edge  = set((  i, n-1) for i in range(m))
        bottom_edge = set((m-1,   j) for j in range(n))
        left_edge   = set((  i,   0) for i in range(m))

        atlantic_basin = find_basin(bottom_edge | right_edge)
        pacific_basin  = find_basin(top_edge | left_edge)
        
        watershed = pacific_basin & atlantic_basin

        return list(watershed)