from operator import add, sub, mul

def fdiv(a, b): # Python\'s floor div won\'t work properly for negative number. ex: -5 // 2 = -3
    sign = 1 if a * b >= 0 else -1
    val = abs(a) // abs(b)
    return sign * val 

class Solution:
    def calculate(self, s: str) -> int:
        # Point, we don\'t need to care about minus sign number.
        # ex: "-3", "2 * -5" are invalid.
        # So string always starts from digits, then operator.
        
        # format: a op b op2 ...
        
        # How can we evaluate?
        # if op was add or sub, we can eval a, and add total.
        # if op was mul or div, we need to lazy eval a until we confirm b. (store as prev_val)
        
        prev_v = 0
        prev_op = None
        
        v = 0
        sign = 1
        
        total = 0
        
        ops = {
            \'+\': add,
            \'-\': sub,
            \'*\': mul,
            \'/\': fdiv
        }
        
        for c in s + \'+\': # Added an add operator to ensure flusing the last number.
            if c.isdigit():
                v *= 10
                v += int(c)
            elif c in ops:
                op = ops[c]
                curr_v = v * sign
                
                # Lazy eval part.
                if prev_op is not None:
                    curr_v = prev_op(prev_v, curr_v)
                    # Clear lazy value slot.
                    prev_v = 0
                    prev_op = None
                
                # Evaluate value here or store value to prev_v based on the current operator.
                if op in (add, sub):
                    total += curr_v
                else: # op in (mul, fdiv)
                    # Store current value and operator for lazy evaluation.
                    prev_v = curr_v
                    prev_op = op
                
                # Set sign and reset v for the next number.
                sign = 1 if op is not sub else -1
                v = 0
            else: # Spaces
                pass
        
        return total