class Solution:
    def calculate(self, s: str) -> int:
        
        def evaluate(q) :
            
            # calculation requires 3 terms : number operator number
            # (1) number
            prod = q.popleft()
            
            while q :
                
                # (2) operator
                op = q.popleft()
                
                # terminate expression
                if len(q)==0 :
                    if op==\'+\' or op==\'$\' :
                        return prod, False
                    else :
                        return prod, True
                    
                # (3) number
                num = q.popleft()
                
                # execution
                if op==\'/\' :
                    prod //= num
                elif op==\'*\' :
                    prod *= num
                    
                
        # *** algorithm ***
        from collections import deque
        addQueue = deque()
        
        # split operator and number. stores them in expr.
        expr = deque()
        j = 0
        negateNext = False
        for i in range(len(s)) :
            
            if s[i]==\'*\' or s[i]==\'/\' or s[i]==\'+\' or s[i]==\'-\' :
                
                # number is s[j:i] (before operator), operator is s[i]
                num = int(s[j:i])
                op = s[i]
                
                # put index j after operator
                j = i + 1
                
                # stores number and operator in expr 
                expr.append(num)
                expr.append(op)
            
        # add last number
        num=int(s[j:])
            
        # sotores in expr
        expr.append(num)
        expr.append(\'$\')  # sign of end

        
        #  considering the priority of operator, buffering (here, addQueue) is required.
        #  extract add and operators :
        #
        #  if operator is \'/\' or \'*\', we just push number and operator to addQueue, and wait next.
        #  if operator is \'+\' or \'-\' or \'$\', we push them addQueue, evaluate all in addQueue, and shift.
        #
        
        add = 0
        negate = False
        while expr :
            
            num = expr.popleft()
            op  = expr.popleft()
            addQueue.append(num)
            addQueue.append(op)
            
            if op==\'+\' or op==\'-\' or op==\'$\' :
                prod, negate_next = evaluate(addQueue)
                if negate :
                    add += -prod
                else :
                    add += +prod
                negate = negate_next
                
        return add