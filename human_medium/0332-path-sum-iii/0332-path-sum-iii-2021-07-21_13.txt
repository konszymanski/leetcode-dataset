from collections import defaultdict

class Solution:
    count = 0
    
    def getans(self, root, targetSum, cursum, D):
        if not root: return
        cursum += root.val;
        if D[cursum-targetSum] != 0: self.count += D[cursum-targetSum]
        D[cursum] += 1
        self.getans(root.left, targetSum, cursum, D)
        self.getans(root.right, targetSum, cursum, D)
        D[cursum] -= 1
    
    def pathSum(self, root: TreeNode, targetSum: int) -> int:
        D = defaultdict(int)
        D[0] = 1
        self.getans(root, targetSum, 0, D)
        return self.count