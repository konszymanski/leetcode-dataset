class Solution:
    def pathSum(self, root: Optional[TreeNode], targetSum: int) -> int:
        ret = 0
        f = defaultdict(int)
        f[0] = 1
		# s is sum before root
        def dfs(root, s):
            if root == None:
                return
            nonlocal ret
            ret += f[s + root.val - targetSum]
            f[s + root.val] += 1
            dfs(root.left, s + root.val)
            dfs(root.right, s + root.val)
            f[s + root.val] -= 1
        dfs(root, 0)
        return ret