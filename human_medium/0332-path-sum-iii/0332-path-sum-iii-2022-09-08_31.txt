class Solution:
    def pathSum(self, root: Optional[TreeNode], targetSum: int) -> int:
        prefixSums = Counter()
        prefixSums[0] = 1
        res = 0
        
        def dfs(node, runningSum):
            nonlocal res
            if node is None:
                return
            runningSum += node.val
            res += prefixSums[runningSum - targetSum]
            prefixSums[runningSum] += 1
            dfs(node.left, runningSum)
            dfs(node.right, runningSum)
            prefixSums[runningSum] -= 1
            
        dfs(root, 0)
        return res
    # Time: O(n)
    # Space: O(n)