class Solution:
    def traversal(self, node, path_sum, path_sum_to_occurrences, target, ret):
        if (node):
            path_sum += node.val
            required_path_sum = path_sum - target
            

            if (required_path_sum in path_sum_to_occurrences):
                ret[0] += path_sum_to_occurrences[required_path_sum]
                
            
            if (path_sum == target):
                ret[0] += 1
                
            path_sum_to_occurrences[path_sum] += 1
            self.traversal(node.left, path_sum, path_sum_to_occurrences , target, ret)
            self.traversal(node.right, path_sum, path_sum_to_occurrences , target, ret)
            path_sum_to_occurrences[path_sum] -= 1
        
        
        
    def pathSum(self, root: TreeNode, sum: int) -> int:
        path_sum_to_occurrences = collections.defaultdict(int)
        ret = [0]
        self.traversal(root, 0, path_sum_to_occurrences , sum, ret)
        return ret[0]