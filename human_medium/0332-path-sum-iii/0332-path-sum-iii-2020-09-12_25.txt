class Solution:
    def pathSum(self, root: TreeNode, sum: int) -> int:
        seen = {0: 1}
        
        def fn(node, prefix):
            """Return number of paths summing to target for tree rooted at node."""
            if not node: return 0 #base condition 
            prefix += node.val # prefix sum up to node 
            ans = seen.get(prefix - sum, 0)
            seen[prefix] = 1 + seen.get(prefix, 0)
            ans += fn(node.left, prefix) + fn(node.right, prefix)
            seen[prefix] -= 1 # backtrack 
            return ans
        
        return fn(root, 0)